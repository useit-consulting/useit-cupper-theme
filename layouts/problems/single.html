{{ define "main" }}
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use xlink:href="#bookmark"></use>
      </svg>
      {{ .Title }}
    </h1>
    {{ if isset .Params "tags" }}
      <div class="tags">
        <strong aria-hidden="true">Tags: </strong>
        <ul aria-label="tags">
          {{ range .Params.tags }}
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}">{{ . }}</a>
            </li>
          {{ end }}
          {{ range .Params.wcag }}
          <li>
            <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
              <use xlink:href="#tag"></use>
            </svg>
            <a href="{{ "/wcag/" | relLangURL }}{{ . | urlize }}">wcag{{ . }}</a>
          </li>
          {{ end }}
        </ul>
      </div>
    {{ end }}
    {{ if ne .Params.TOC false }}
      {{ partial "toc" . }}
    {{ end }}

    <h2>Problem description</h2>
    <div class="text-container">
      {{ .Params.problemDescription | markdownify }}
    </div>

    <h2>Suggested solution</h2>
    <div class="text-container">
      {{ .Params.suggestedSolution | markdownify }}
    </div>

    <div class="expandable-section">
      <h2>
      <button aria-expanded="true" data-expands="js-expandable-priority">
        <span>
            <span class="icon-background">
              <svg class="priority-icon" aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                <use xlink:href="#priority"></use>
              </svg>
            </span>
            <span class="expandable-label">Priority (1-4)</span>
          </span>
      <svg class="expandable-icon" aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
      </button>
      </h2>
      <div id="js-expandable-priority">
      {{ if eq $.Page.Params.weight 1 }} Critical ({{ .Params.weight }}) {{ end }}
      {{ if eq $.Page.Params.weight 2 }} High priority ({{ .Params.weight }}) {{ end }}
      {{ if eq $.Page.Params.weight 3 }} Medium priority ({{ .Params.weight }}) {{ end }}
      {{ if eq $.Page.Params.weight 4 }} Low priority ({{ .Params.weight }}) {{ end }}
    </div>
    </div>

    <div class="expandable-section">
      <h2>
        <button aria-expanded="false" data-expands="js-expandable-usergroups">
          <span>
            <span class="icon-background">
            <svg class="users-icon" aria-hidden="true" viewBox="0 0 24 24" focusable="false">
              <use xlink:href="#users"></use>
            </svg>
            </span>
            <span class="expandable-label">Affected user groups</span>
          </span>
          <svg class="expandable-icon" aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
            <g transform="translate(0 -981.5)">
              <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
              <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
            </g>
          </svg>
        </button>
      </h2>
      <div id="js-expandable-usergroups" hidden>
        <ul class="usergroups">
          {{ range .Params.usergroups }}
          <li>{{ . }}</li>
          {{ end }}
        </ul>
      </div>
    </div>

      <div class="expandable-section">
        <h2>
          <button aria-expanded="false" data-expands="js-expandable-wcag">
            <span><span class="icon-background">
            <svg class="wcag-icon" aria-hidden="true" viewBox="0 0 127.09899 67.763" focusable="false">
              <use xlink:href="#w3c"></use>
            </svg>
            </span>
            <span class="expandable-label">WCAG 2.1 violations</span>
          </span>
            <svg class="expandable-icon" aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
              <g transform="translate(0 -981.5)">
                <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
                <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
              </g>
            </svg>
          </button>
        </h2>

        <div id="js-expandable-wcag" hidden>
          {{ $JSON := $.Site.Data.wcag }}
          {{ $included := .Params.wcag }}
          {{ $isIncluded := false }}
          <ul class="wcag">
            {{ range $JSON }}
              {{ if in $.Page.Params.wcag .ref_id }}
                {{ $isIncluded = true }}
                <li>
                  <strong><a href="{{ "/wcag/" | relLangURL }}{{ .ref_id | urlize }}">
                    {{ .ref_id }} {{ .title }}</a> (level {{ .level }})
                  </strong>
                </li>
              {{ end }}
            {{ end }}
            {{ if eq $isIncluded false }}
            <li><p>No</p></li>
            {{ end }}
          </ul>
        </div>
      </div>
    <div class="copy-buttons">
      <button type="button" class="copyBtn" onclick="generateJiraDescription()">Copy as JIRA</button>
      <button type="button" class="copyBtn" onclick="generateMarkdownDescription()">Copy as Markdown</button>
    </div>

  </main>
<script>
  const problemDescriptionWithImage = '{{ .Params.problemDescription }}'.replace(/\/img\//g, '{{ .Site.BaseURL }}img/');
  const suggestedSolutionsWithImage = '{{ .Params.suggestedSolution }}'.replace(/\/img\//g, '{{ .Site.BaseURL }}img/');

  function generateJiraDescription() {
    return copyRichText(`${J2M.toJ('# {{ .Title }}\n')}${J2M.toJ('## Problem description\n')}${J2M.toJ(problemDescriptionWithImage+'\n')}${J2M.toJ('## Suggested solution\n')}${J2M.toJ(suggestedSolutionsWithImage+'\n')}${J2M.toJ('## Priority\n')}${J2M.toJ('{{ if eq $.Page.Params.weight 1 }} Critical ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 2 }} High priority ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 3 }} Medium priority ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 4 }} Low priority ({{ .Params.weight }}) {{ end }}\n')}${J2M.toJ('## Affected user groups\n')}${J2M.toJ('{{ range .Params.usergroups }}- {{ . }}\n {{ end }}\n')}${J2M.toJ('## WCAG 2.1 violations\n')}${J2M.toJ('{{ $JSON := $.Site.Data.wcag }}{{$included := .Params.wcag}}{{ $isIncluded := false }}{{ range $JSON }}{{ if in $.Page.Params.wcag .ref_id }}{{ $isIncluded = true }}- {{ .ref_id }} {{ .title }} (level {{ .level }}){{ end }}{{ end }}{{ if eq $isIncluded false }} * No {{ end }}')}`)
  }
  function generateMarkdownDescription() {
    return copyRichText(`# {{ .Title }}\n\n## Problem description\n\n${problemDescriptionWithImage}\n\n## Suggested solution\n\n${suggestedSolutionsWithImage}\n\n## Priority\n\n{{ if eq $.Page.Params.weight 1 }} Critical ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 2 }} High priority ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 3 }} Medium priority ({{ .Params.weight }}) {{ end }} {{ if eq $.Page.Params.weight 4 }} Low priority ({{ .Params.weight }}) {{ end }}\n\n## Affected user groups\n\n{{ range .Params.usergroups }}- {{ . }}\ {{ end }}\n\n## WCAG 2.1 violations\n\n{{ $JSON := $.Site.Data.wcag }}{{$included := .Params.wcag}}{{ $isIncluded := false }}{{ range $JSON }}{{ if in $.Page.Params.wcag .ref_id }}{{ $isIncluded = true }}- {{ .ref_id }} {{ .title }} (level {{ .level }}){{ end }}{{ end }}{{ if eq $isIncluded false }} * No {{ end }}`)
  }
</script>
{{ end }}